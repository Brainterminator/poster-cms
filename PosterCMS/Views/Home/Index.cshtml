@{
    ViewData["Title"] = "Home Page";
    var pagesize = Context.Request.Cookies["PageSize"];
}

@model List<PosterModel>

<h1>Posters</h1>

<section class="poster-grid @(pagesize == "A3" ? "a3" : "")">
    <a class="button add-poster" asp-area="" asp-controller="Poster" asp-action="Create">+</a>
    @{
        foreach (var poster in Model){
            <article class="poster-preview">
                <a asp-area="" asp-controller="Poster" asp-action="Index" asp-route-id=@poster.ID><img src="/thumbnails/@(poster.ID)@(pagesize == "A3" ? "-A3-landscape" : "-A4-portrait").jpg"></a>
                <div class="poster-labels">
                    <a asp-area="" asp-controller="Poster" asp-action="Index" asp-route-id=@poster.ID>@poster.Title</a>
                    <a asp-area="" asp-controller="Poster" asp-action="Index" asp-route-id=@poster.ID><p class="time">@poster.EditDate.ToString().Split(' ')[0]</p></a>
                </div>
            </article>
        }
    }
</section>

@section Scripts {
<script>
    document.addEventListener('pageSizeChanged', function(e) {
        const newPageSize = e.detail.pageSize;
        const posterGrid = document.querySelector('.poster-grid');
        
        if (!posterGrid) return;

        // Toggle the class to animate the grid size
        if (newPageSize === 'A3') {
            posterGrid.classList.add('a3');
        } else {
            posterGrid.classList.remove('a3');
        }

        // Find all poster images and update their source
        const images = posterGrid.querySelectorAll('.poster-preview img');
        images.forEach(img => {
            if (newPageSize === 'A3') {
                // Change A4 source to A3 source
                img.src = img.src.replace('-A4-portrait.jpg', '-A3-landscape.jpg');
            } else {
                // Change A3 source to A4 source
                img.src = img.src.replace('-A3-landscape.jpg', '-A4-portrait.jpg');
            }
        });
    });
</script>
}